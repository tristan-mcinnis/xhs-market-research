<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xiaohongshu Scraper</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Password Gate -->
    <div id="password-gate" class="container">
        <div class="card">
            <h1>üîí XHS Market Research</h1>
            <p class="url-display">üìç https://tristan-mcinnis.github.io/xhs-market-research/</p>
            <p>Enter team password to access the scraper</p>
            <form id="password-form">
                <input
                    type="password"
                    id="password-input"
                    placeholder="Enter password"
                    autocomplete="off"
                    required
                >
                <button type="submit">Unlock</button>
            </form>
            <p id="password-error" class="error"></p>
        </div>
    </div>

    <!-- Main Interface -->
    <div id="main-interface" class="container hidden">
        <div class="header">
            <h1>üì± Xiaohongshu Scraper</h1>
            <button id="logout-btn" class="logout-btn">Logout</button>
        </div>

        <!-- Search Form -->
        <div class="card">
            <h2>üîç Search Configuration</h2>
            <form id="scraper-form">
                <div class="form-group">
                    <label for="keywords">Keywords (space-separated)</label>
                    <input
                        type="text"
                        id="keywords"
                        placeholder="e.g., coffee shops tokyo"
                        required
                    >
                    <small>Separate multiple keywords with spaces</small>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="max-items">Max Items</label>
                        <input
                            type="number"
                            id="max-items"
                            value="30"
                            min="1"
                            max="200"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label for="max-downloads">Max Downloads</label>
                        <input
                            type="number"
                            id="max-downloads"
                            placeholder="Unlimited"
                            min="1"
                        >
                        <small>Leave empty for no limit</small>
                    </div>
                </div>

                <div class="form-group checkbox-group">
                    <label>
                        <input type="checkbox" id="download-images" checked>
                        Download images
                    </label>
                </div>

                <button type="submit" id="run-btn" class="primary-btn">
                    ‚ñ∂Ô∏è Run Scraper
                </button>
            </form>
        </div>

        <!-- Status Display -->
        <div id="status-card" class="card hidden">
            <h2>‚öôÔ∏è Status</h2>
            <div id="status-content">
                <div class="status-item">
                    <span class="status-label">Workflow:</span>
                    <span id="workflow-status" class="status-value">Initializing...</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Progress:</span>
                    <span id="workflow-progress" class="status-value">Starting...</span>
                </div>
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill"></div>
                </div>
                <div class="spinner"></div>
            </div>
        </div>

        <!-- Results Display -->
        <div id="results-card" class="card hidden">
            <h2>‚úÖ Results</h2>
            <div id="results-content">
                <div class="results-info">
                    <p><strong>Workflow ID:</strong> <span id="workflow-id"></span></p>
                    <p><strong>Status:</strong> <span id="final-status"></span></p>
                    <p><strong>Completed:</strong> <span id="completion-time"></span></p>
                </div>
                <div id="download-section" class="hidden">
                    <button id="download-btn" class="download-btn">
                        üì• Download Results
                    </button>
                    <p class="download-note">Results include scraped JSON data and downloaded images (if enabled)</p>
                </div>
                <div id="error-section" class="hidden error">
                    <p><strong>Error:</strong> <span id="error-message"></span></p>
                    <button id="view-logs-btn" class="secondary-btn">View Logs</button>
                </div>
            </div>
        </div>

        <!-- Audit Log -->
        <div class="card">
            <h2>üìä Audit Log</h2>
            <div id="audit-controls">
                <button id="refresh-audit-btn" class="secondary-btn">üîÑ Refresh</button>
                <div class="audit-stats">
                    <span>Total runs: <strong id="total-runs">0</strong></span>
                    <span>Total posts: <strong id="total-posts">0</strong></span>
                    <span>Total images: <strong id="total-images">0</strong></span>
                </div>
            </div>
            <div id="audit-log-container">
                <p class="loading">Loading audit log...</p>
            </div>
        </div>

        <!-- Advanced Options (Collapsed) -->
        <details class="card">
            <summary>‚öôÔ∏è Advanced Options</summary>
            <div class="advanced-options">
                <p><strong>GitHub Repository:</strong> <span id="repo-name">Loading...</span></p>
                <p><strong>Workflow File:</strong> <code>web-scrape.yml</code></p>
                <p><strong>Actor ID:</strong> <code>watk8sVZNzd40UtbQ</code></p>
                <div class="form-group">
                    <label for="github-token">GitHub Token (optional - for API rate limits)</label>
                    <input
                        type="password"
                        id="github-token"
                        placeholder="ghp_..."
                        autocomplete="off"
                    >
                    <small>Only needed if you hit rate limits. Token needs 'actions:write' permission.</small>
                </div>
            </div>
        </details>
    </div>

    <script src="app.js"></script>
</body>
</html>
